%% 1. 테스트 데이터 전체 불러오기
X_full = readtable('farsite_test_label.csv');  % 전체 정보 포함 (grid_id, 위경도 등)
Y_true = readtable('cfis_test_label.csv');     % 정답 pSpread (원할 경우 비교용)

% 예측용 입력 피처 21개만 추출
excludeCols = {'grid_id', 'lat_min', 'lat_max', ...
               'lon_min', 'lon_max', 'center_lat', 'center_lon'};
X_test = removevars(X_full, intersect(X_full.Properties.VariableNames, excludeCols));

%% 2. 모델 불러오기 (이미 메모리에 있다면 생략)
load('random_forest_pspread_model_300trees_20250706_101534.mat');

%% 3. 예측 수행
Y_pred = predict(Mdl, X_test);

%% 4. 결과 테이블 구성
result_table = table( ...
    X_full.grid_id, ...
    X_full.lat_min, X_full.lat_max, ...
    X_full.lon_min, X_full.lon_max, ...
    X_full.center_lat, X_full.center_lon, ...
    Y_pred, ...
    'VariableNames', {'grid_id', 'lat_min', 'lat_max', ...
                      'lon_min', 'lon_max', ...
                      'center_lat', 'center_lon', ...
                      'pSpread_pred'});

%% 5. 결과 저장
output_filename = ['predicted_pspread_with_coords_', datestr(now, 'yyyymmdd_HHMMSS'), '.csv'];
writetable(result_table, output_filename);
fprintf('[✅ 완료] 예측 결과가 "%s"로 저장되었습니다.\n', output_filename);
