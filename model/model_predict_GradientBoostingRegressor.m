%% ğŸ”¹ 1. í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
fprintf("[INFO] í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...\n");
test = readtable("test_label.csv");

fprintf("[INFO] FARSITE í‰ê·  ì „ì´ í™•ë¥  ê³„ì‚° ì¤‘...\n");
farsite_cols = {'P_NW','P_N','P_NE','P_W','P_E','P_SW','P_S','P_SE'};
farsite_vals = test{:, farsite_cols};
test.farsite_prob = mean(farsite_vals, 2);  % NaN ì—†ìœ¼ë¯€ë¡œ ë°”ë¡œ mean ì‚¬ìš© ê°€ëŠ¥

%% ğŸ”¹ 2. ì…ë ¥ í”¼ì²˜ êµ¬ì„± (í•™ìŠµê³¼ ë™ì¼í•˜ê²Œ)
fprintf("[INFO] ì…ë ¥ í”¼ì²˜ êµ¬ì„± ì¤‘...\n");
X = test{:, {
    'avg_fuelload_pertree_kg', ...
    'FFMC', 'DMC', 'DC', ...
    'NDVI', 'smap_20250630_filled', ...
    'temp_C', 'humidity', ...
    'wind_speed', 'wind_deg', ...
    'precip_mm', 'mean_slope', 'spei_recent_avg', ...
    'farsite_prob'
}};

%% ğŸ”¹ 3. í•™ìŠµëœ ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ê¸°
fprintf("[INFO] í•™ìŠµëœ Gradient Boosting ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...\n");
load("gradient_boosting_pspread_model_300trees_20250706_131211.mat");  % íŒŒì¼ëª…ì€ í•„ìš”ì‹œ ë³€ê²½

%% ğŸ”¹ 4. ì˜ˆì¸¡ ìˆ˜í–‰
fprintf("[INFO] ì˜ˆì¸¡ ìˆ˜í–‰ ì¤‘...\n");
Y_pred = predict(model, X);

%% ğŸ”¹ 5. ê²°ê³¼ í…Œì´ë¸” êµ¬ì„±
fprintf("[INFO] ê²°ê³¼ í…Œì´ë¸” ìƒì„± ì¤‘...\n");
result_table = table( ...
    test.grid_id, ...
    test.lat_min, test.lat_max, ...
    test.lon_min, test.lon_max, ...
    test.center_lat, test.center_lon, ...
    Y_pred, ...
    'VariableNames', {'grid_id', 'lat_min', 'lat_max', ...
                      'lon_min', 'lon_max', ...
                      'center_lat', 'center_lon', ...
                      'pSpread_pred'});

%% ğŸ”¹ 6. ê²°ê³¼ ì €ì¥
output_filename = ['gbr_predicted_pspread_', datestr(now, 'yyyymmdd_HHMMSS'), '.csv'];
writetable(result_table, output_filename);

fprintf("[INFO] ì˜ˆì¸¡ ê²°ê³¼ íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ â†’ %s\n", output_filename);
